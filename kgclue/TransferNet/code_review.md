# 第一个地方

```python
m=last_e.gt(1).float()#凡是大于1的值变成1，小于1的值变成0
z=(m*last_e+(1-m)).detach()#凡是大于1的值不变，小于1的值变成1
last_e=last_e/z#凡是大于1的值变成1，小于1的值不变
```

![image-20211207200747472](C:\Users\User\AppData\Roaming\Typora\typora-user-images\image-20211207200747472.png)

detach表明反向传播阶段不需要对z求梯度。

# 第二个地方

```python
weight=answer*99+1
loss=torch.sum(entity_range*weight*torch.pow(last_e-answers,2))/torch.sum(entity_range*weight)
```

假设有6个实体，而且：

```bash
answers=[0,0,1,0,0,0]#表明第3个实体是答案
entity_range=[0,1,1,0,0,1]#表明第2、3、6这三个实体与问题中的topic entity在2跳路径之内
last_e=[0.1,0.3,0.8,0.3,0.7,0.6]#模型预测每一个实体作为答案的概率
```



计算得出：

```bash
weight=[1,1,100,1,1,1]
entity_range*weight=[0,1,100,0,0,1]
```

模型预测值与真实标签之间的均方误差为pow(last_e-answers,2)。

**所以可以看出，计算损失时乘以entity_range*weight这一项的目的就是让与当前问题中的topic entity超出n跳路径外的所有实体对loss零贡献，即在计算损失值时不考虑这些与问题中的topic entity超出n跳路径外的其他实体，因为这些实体不太可能作为当前问题的答案，因此让模型在预测答案的时候不考虑这些实体。同时针对答案实体，使得其对损失的贡献最大**



==现在已经实验了简单的MSE会降低准确率，接下来需要实验99这个参数的效果，也就是如果所有在entity_range中的实体都一视同仁的话，效果会如何。==



# 第三个地方

也是论文的核心，**即hop是怎么实现的**

假设有6个三元组：

| 三元组     | 头实体 | 关系 | 尾实体 |
| ---------- | ------ | ---- | ------ |
| (h1,r1,t1) | h1     | r1   | t1     |
| (h2,r2,t2) | h2     | r2   | t2     |
| (h3,r3,t3) | h3     | r3   | t3     |
| (h4,r2,t4) | h4     | r2   | t4     |
| (h5,r1,t2) | h5     | r1   | t2     |
| (h3,r2,t1) | h3     | r2   | t1     |

那么可以计算出整个知识图谱有9个实体，3个关系。

实体分别是：

| 实体 | 编号 |
| ---- | ---- |
| h1   | 0    |
| h2   | 1    |
| h3   | 2    |
| h4   | 3    |
| h5   | 4    |
| t1   | 5    |
| t2   | 6    |
| t3   | 7    |
| t4   | 8    |

关系分别是：

| 关系 | 编号 |
| ---- | ---- |
| r1   | 0    |
| r2   | 1    |
| r3   | 2    |

三元组的矩阵形式：

$\begin{pmatrix}
0 &0  &5 \\ 
 1&1  &6 \\ 
 2&2  &7 \\ 
 3&1  & 8\\ 
 4&  0& 6\\ 
 2& 1 & 5
\end{pmatrix}$





# 实验记录

| 实验不同的参数 | nlpcc2018 | WebQSP |
| -------------- | --------- | ------ |
| 版本1          | 0.738     |        |
| 版本2          | 0.714     |        |
| 版本3          | 0.723     |        |

- 版本1
- 版本2
- 版本3

# 实现问答系统

## 任务概述

### 1. 任务介绍

### 2. 图谱介绍

## 数据处理

### 1. 实体识别数据处理

### 2. 问答数据处理

### 3. 图谱构建

## 模型介绍

### 1. 论文讲解

### 2. 逐步剖析

### 3. 模型实现















| 符号      | 说明                   |
| --------- | ---------------------- |
| KG        | 知识图谱               |
| $T_{big}$ | 大规模KG中的三元组集合 |
| $E_{big}$ | 大规模KG中的实体集合   |
| $R_{big}$ | 大规模KG中的关系集合   |

